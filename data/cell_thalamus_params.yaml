# Cell Thalamus v1 Phase 0 Parameters
# Defines stress axes, compound mappings, and morphology channel responses

# Stress axes and their effects on Cell Painting channels
stress_axes:
  oxidative:
    description: "Oxidative stress (ROS production)"
    channels:
      er: 0.3        # ER stress secondary to oxidative damage
      mito: 1.5      # Strong mitochondrial response
      nucleus: 0.2   # Nuclear condensation
      actin: -0.4    # Cytoskeleton disruption
      rna: 0.1       # Translation stress

  er_stress:
    description: "Endoplasmic reticulum stress (protein folding)"
    channels:
      er: 2.0        # Primary ER response
      mito: 0.5      # Secondary mitochondrial stress
      nucleus: 0.3   # Nuclear stress response
      actin: 0.0     # Minimal cytoskeleton change
      rna: 0.8       # UPR activation

  mitochondrial:
    description: "Mitochondrial dysfunction"
    channels:
      er: 0.4        # ER-mito crosstalk
      mito: 2.5      # Primary mitochondrial response
      nucleus: 0.5   # Metabolic stress signaling
      actin: -0.3    # Energy-dependent structure loss
      rna: 0.2       # Metabolic adaptation

  dna_damage:
    description: "DNA damage and cell cycle arrest"
    channels:
      er: 0.1        # Minimal ER stress
      mito: 0.3      # Apoptotic priming
      nucleus: 1.8   # Primary nuclear response
      actin: -0.2    # Cell cycle arrest morphology
      rna: 0.6       # DNA damage response genes

  proteasome:
    description: "Proteasome inhibition (protein aggregation)"
    channels:
      er: 1.2        # Protein accumulation in ER
      mito: 0.4      # Secondary stress
      nucleus: 0.7   # Nuclear protein aggregates
      actin: -0.5    # Aggresome formation
      rna: 1.0       # Stress response transcription

  microtubule:
    description: "Microtubule disruption"
    channels:
      er: 0.2        # Minimal ER stress
      mito: 0.3      # Mitotic arrest
      nucleus: 1.0   # Mitotic catastrophe
      actin: 0.8     # Cytoskeletal reorganization
      rna: 0.1       # Minimal transcriptional change

# Compound panel - maps to stress axes
compounds:
  tBHQ:
    name: "tert-Butylhydroquinone"
    stress_axis: "oxidative"
    intensity: 0.8  # Moderate morphology effect
    ec50_uM: 30.0   # EC50 at 30 µM gives gentler viability curve
    hill_slope: 1.2  # Gentle curve so middle doses show clear effects

  H2O2:
    name: "Hydrogen Peroxide"
    stress_axis: "oxidative"
    intensity: 1.2
    ec50_uM: 100.0
    hill_slope: 2.0

  hydrogen_peroxide:
    name: "Hydrogen Peroxide"
    stress_axis: "oxidative"
    intensity: 1.2
    ec50_uM: 100.0
    hill_slope: 2.0

  tunicamycin:
    name: "Tunicamycin"
    stress_axis: "er_stress"
    intensity: 1.0
    ec50_uM: 1.0
    hill_slope: 1.8

  thapsigargin:
    name: "Thapsigargin"
    stress_axis: "er_stress"
    intensity: 1.1
    ec50_uM: 0.5
    hill_slope: 2.2

  etoposide:
    name: "Etoposide"
    stress_axis: "dna_damage"
    intensity: 1.0
    ec50_uM: 10.0
    hill_slope: 1.6

  cccp:
    name: "CCCP"
    stress_axis: "mitochondrial"
    intensity: 1.3
    ec50_uM: 5.0
    hill_slope: 2.5  # Steeper hill for sharper transition

  CCCP:
    name: "CCCP"
    stress_axis: "mitochondrial"
    intensity: 1.3
    ec50_uM: 5.0
    hill_slope: 2.5  # Steeper hill for sharper transition

  oligomycin_a:
    name: "Oligomycin A"
    stress_axis: "mitochondrial"
    intensity: 1.0
    ec50_uM: 1.0
    hill_slope: 2.3

  oligomycin:
    name: "Oligomycin A"
    stress_axis: "mitochondrial"
    intensity: 1.0
    ec50_uM: 1.0
    hill_slope: 2.3

  two_deoxy_d_glucose:
    name: "2-Deoxy-D-Glucose"
    stress_axis: "mitochondrial"
    intensity: 0.7
    ec50_uM: 1000.0
    hill_slope: 1.2

  mg132:
    name: "MG132"
    stress_axis: "proteasome"
    intensity: 1.0
    ec50_uM: 1.0
    hill_slope: 1.9

  MG132:
    name: "MG132"
    stress_axis: "proteasome"
    intensity: 1.0
    ec50_uM: 1.0
    hill_slope: 1.9

  nocodazole:
    name: "Nocodazole"
    stress_axis: "microtubule"
    intensity: 1.0
    ec50_uM: 0.5
    hill_slope: 2.1

  paclitaxel:
    name: "Paclitaxel"
    stress_axis: "microtubule"
    intensity: 1.1
    ec50_uM: 0.01
    hill_slope: 2.0

  cisplatin:
    name: "Cisplatin"
    stress_axis: "dna_damage"
    intensity: 1.2
    ec50_uM: 5.0
    hill_slope: 1.8

  doxorubicin:
    name: "Doxorubicin"
    stress_axis: "dna_damage"
    intensity: 1.3
    ec50_uM: 0.5
    hill_slope: 2.0

  staurosporine:
    name: "Staurosporine"
    stress_axis: "dna_damage"
    intensity: 1.5
    ec50_uM: 0.1
    hill_slope: 2.5

  tbhp:
    name: "tert-Butyl hydroperoxide"
    stress_axis: "oxidative"
    intensity: 1.0
    ec50_uM: 80.0
    hill_slope: 2.0

# Baseline morphology per cell line (arbitrary units)
baseline_morphology:
  A549:
    er: 100.0
    mito: 150.0
    nucleus: 200.0
    actin: 120.0
    rna: 180.0

  HepG2:
    er: 130.0      # Hepatocytes have high ER
    mito: 180.0    # High metabolic activity
    nucleus: 190.0
    actin: 110.0
    rna: 200.0     # High protein synthesis

  U2OS:
    er: 95.0
    mito: 140.0
    nucleus: 210.0  # Large nuclei
    actin: 130.0
    rna: 170.0

  iPSC_NGN2:  # iPSC-derived NGN2 neurons
    er: 85.0        # Lower ER (no high secretory load)
    mito: 220.0     # Very high mitochondria (energy-hungry neurons)
    nucleus: 180.0   # Moderate nucleus size
    actin: 160.0     # High actin (neurite outgrowth, cytoskeleton)
    rna: 140.0       # Moderate RNA (post-mitotic, less transcription than dividing cells)

  iPSC_Microglia:  # iPSC-derived microglia (brain immune cells)
    er: 140.0        # High ER (cytokine/protein secretion)
    mito: 170.0      # High mitochondria (active immune cells)
    nucleus: 170.0   # Moderate nucleus
    actin: 150.0     # High actin (phagocytosis, migration)
    rna: 190.0       # High RNA (inflammatory protein synthesis)

# ATP viability baseline (luminescence units)
baseline_atp:
  A549: 50000.0
  HepG2: 60000.0  # Higher metabolic activity
  U2OS: 45000.0
  iPSC_NGN2: 70000.0  # Very high ATP (neurons have extremely high metabolic rate)
  iPSC_Microglia: 65000.0  # High ATP (active immune cells)

# Cell line-specific hardware sensitivity
# Different cell lines respond differently to mechanical stress from liquid handlers
hardware_sensitivity:
  A549:
    attachment_efficiency: 0.95    # Good attachment (adherent cancer line)
    shear_sensitivity: 0.8         # Robust to pipetting (cancer cells)
    mechanical_robustness: 1.2     # Hardy cells
    coating_required: false        # Cancer cells don't need coating

  HepG2:
    attachment_efficiency: 0.90    # Moderate attachment (hepatocytes)
    shear_sensitivity: 1.0         # Normal shear sensitivity
    mechanical_robustness: 1.0     # Baseline robustness
    coating_required: false        # Cancer cells don't need coating

  U2OS:
    attachment_efficiency: 0.95    # Good attachment (osteosarcoma)
    shear_sensitivity: 0.7         # Very robust (bone cancer)
    mechanical_robustness: 1.3     # Very hardy
    coating_required: false        # Cancer cells don't need coating

  iPSC_NGN2:
    attachment_efficiency: 0.70    # Poor attachment (neurons don't stick well)
    shear_sensitivity: 2.0         # Very fragile (neurites shear off)
    mechanical_robustness: 0.5     # Delicate cells
    coating_required: true         # Neurons REQUIRE coating (poly-L-lysine/laminin)
    coating_type: "poly-L-lysine"  # Coating type for reference

  iPSC_Microglia:
    attachment_efficiency: 0.85    # Moderate attachment (semi-adherent immune cells)
    shear_sensitivity: 1.3         # Somewhat fragile (suspension-like)
    mechanical_robustness: 0.8     # Less robust than cancer lines
    coating_required: false        # Immune cells don't need coating

  # Default for unknown cell lines
  DEFAULT:
    attachment_efficiency: 0.90
    shear_sensitivity: 1.0
    mechanical_robustness: 1.0
    coating_required: false

# Technical variance parameters (coefficient of variation)
# Tuned so DMSO controls have ~2-3% total CV (realistic for high-content screening)
#
# SEEDING PROCESS PRESETS (row A→P drift calibration):
# These parameters model different liquid handling processes and produce different
# spatial gradients. The default preset is "median_manual_8ch" which produces ~8% A→P drift.
#
#   preset: median_manual_8ch (DEFAULT)
#     - Expected A→P drift: 5-10%
#     - Process: EL406 8-channel pipette, sequential row processing, no remix between rows
#     - Settings: cell_suspension_settling_cv = 0.04, plate_level_drift_cv = 0.005
#     - Story: Realistic "median day" performance, cells settle during ~60-180s dispense time
#     - Use when: Modeling semi-automated processes where spatial QC and deconfounding matter
#
#   preset: bestday_bulk_agitated
#     - Expected A→P drift: 1-3%
#     - Process: Automated bulk dispenser with continuous agitation (Multidrop, Certus)
#     - Settings: cell_suspension_settling_cv = 0.015, plate_level_drift_cv = 0.005
#     - Story: Fast dispense, aggressive mixing, uniform concentration
#     - Use when: Modeling best-case automated liquid handling
#
#   preset: neurons_gentle_coated
#     - Expected A→P drift: 8-12%
#     - Process: iPSC neurons, coated plates, gentle handling to minimize shear
#     - Settings: cell_suspension_settling_cv = 0.05-0.06, coating_quality_cv = 0.08
#     - Story: Attachment amplifies gradient, coating heterogeneity adds spatial structure
#     - Use when: Modeling fragile primary cells or neurons with coating requirements
#
technical_noise:
  plate_cv: 0.010     # 1% plate-to-plate variation
  day_cv: 0.015       # 1.5% day-to-day variation
  operator_cv: 0.008  # 0.8% operator-to-operator variation
  well_cv: 0.015      # 1.5% well-to-well (measurement noise)
  edge_effect: 0.12   # 12% signal reduction for edge wells (evaporation, temperature)
  well_failure_rate: 0.00013  # 0.013% per well → ~5% plate failure rate (384 wells)
  stain_cv: 0.05      # 5% stain lot variation (plate-level, affects ER/Mito/RNA strongly)
  focus_cv: 0.04      # 4% focus variation (tile-level, affects Nucleus/Actin strongly, inflates variance)
  coating_quality_cv: 0.08  # 8% coating quality variation (plate-specific spatial gradient for coated plates)
  cell_suspension_settling_cv: 0.04  # 4% settling drift (amplifies plate-level drift during seeding)
                                     # DEFAULT preset: median_manual_8ch (5-10% A→P drift)
                                     # See presets above for alternative calibrations
  # Heavy-tail noise: Rare lab outliers (focus drift, contamination, bubbles)
  # Models fat-tailed deviations beyond lognormal (Student-t on log-scale)
  # Default DORMANT (frequency=0.0) to preserve golden files and existing tests
  # Enable explicitly for realism runs by setting heavy_tail_frequency > 0
  heavy_tail_frequency: 0.0      # Frequency of heavy-tail shocks (0.0=dormant, 0.01=1%, 0.02=2%)
  heavy_tail_nu: 4.0             # Student-t degrees of freedom (lower=heavier tails, recommend 4)
  heavy_tail_log_scale: 0.35     # Scale on log-space (NOT cv, recommend 0.35 for ~2× typical shock)
  heavy_tail_min_multiplier: 0.2 # Hard floor: max 5× attenuation (prevents signal dropout)
  heavy_tail_max_multiplier: 5.0 # Hard ceiling: max 5× amplification (prevents numeric explosion)

# Well failure modes (when well_failure_rate triggers)
well_failure_modes:
  bubble:
    probability: 0.40  # 40% of failures are bubbles
    effect: "no_signal"  # Imaging fails, all channels near zero
  contamination:
    probability: 0.25  # 25% of failures are contamination
    effect: "outlier_high"  # Abnormally high signal (bacteria/yeast growth)
  pipetting_error:
    probability: 0.20  # 20% of failures are pipetting errors
    effect: "outlier_low"  # Wrong volume, low cell count
  staining_failure:
    probability: 0.10  # 10% of failures are staining issues
    effect: "partial_signal"  # Some channels fail, others OK
  cross_contamination:
    probability: 0.05  # 5% of failures are cross-contamination
    effect: "mixed_signal"  # Signal from neighboring well

# Biological variance
biological_noise:
  cell_line_cv: 0.04  # 4% residual biological noise (modest, per-well biology does heavy lifting)
  dose_response_cv: 0.10  # 10% dose-response variability (unused for now)
  stress_cv_multiplier: 2.0  # Stressed cells show 2× higher CV (heterogeneous death timing)
  # Note: Per-well latent biology (8-10% baseline shifts) is now applied separately in cell_painting.py

# Sentinel definitions (fixed control wells on every plate)
sentinels:
  dmso:
    compound: "DMSO"
    dose_uM: 0.0
    well_positions: ["A1", "A12", "H1", "H12"]  # Corners of 96-well plate

  mild_stress:
    compound: "tBHQ"
    dose_uM: 10.0
    well_positions: ["A6", "H6"]  # Middle edges

  strong_stress:
    compound: "tunicamycin"
    dose_uM: 2.0
    well_positions: ["D6", "E6"]  # Middle of plate

# Dose grid for Phase 0
dose_grid:
  vehicle: 0.0
  low: 0.1      # Fraction of EC50
  mid: 1.0      # At EC50
  high: 10.0    # 10x EC50

# Timepoints (hours post-treatment)
timepoints:
  early: 12
  late: 48

# Plate layout
plate_format: 96  # 96-well plates
wells_per_condition: 3  # Technical replicates per plate

# Cell-line-specific IC50 modifiers (relative to base EC50)
# Captures biological differences in stress sensitivity
cell_line_ic50_modifiers:
  A549:
    # Lung cancer - NRF2 primed (oxidative resistant), fast cycling (microtubule sensitive)
    tBHQ: 1.5          # More resistant to oxidative stress (NRF2 pathway active)
    H2O2: 1.3          # Moderate resistance
    tunicamycin: 1.0   # Baseline ER stress sensitivity
    thapsigargin: 1.0  # Baseline
    CCCP: 1.0          # Baseline mitochondrial stress
    oligomycin: 1.0    # Baseline
    etoposide: 1.0     # Baseline DNA damage
    MG132: 1.0         # Baseline proteasome
    nocodazole: 0.7    # More sensitive (fast cycling)
    paclitaxel: 0.6    # More sensitive (fast cycling)

  HepG2:
    # Hepatoma - High ER load (ER stress sensitive), OXPHOS dependent (mito sensitive)
    tBHQ: 0.9          # Slightly more sensitive
    H2O2: 1.5          # More resistant (high peroxide detox capacity)
    tunicamycin: 0.7   # More sensitive (high ER protein load)
    thapsigargin: 0.7  # More sensitive (high ER calcium load)
    CCCP: 0.8          # More sensitive (OXPHOS dependent)
    oligomycin: 0.8    # More sensitive (OXPHOS dependent)
    etoposide: 1.0     # Baseline
    MG132: 0.8         # More sensitive (high proteostasis burden)
    nocodazole: 1.2    # Less sensitive (slower cycling)
    paclitaxel: 1.3    # Less sensitive (slower cycling)

  U2OS:
    # Osteosarcoma - Baseline for most stresses
    tBHQ: 1.0
    H2O2: 1.0
    tunicamycin: 1.0
    thapsigargin: 1.0
    CCCP: 1.0
    oligomycin: 1.0
    etoposide: 1.0
    MG132: 1.0
    nocodazole: 1.0
    paclitaxel: 1.0

  iPSC_NGN2:
    # iPSC-derived neurons - Post-mitotic, high metabolic rate, oxidative stress sensitive
    tBHQ: 0.5          # Very sensitive to oxidative stress (high ROS baseline)
    H2O2: 0.4          # Extremely sensitive (neurons accumulate oxidative damage)
    tunicamycin: 0.9   # Moderately sensitive to ER stress
    thapsigargin: 0.9  # Moderately sensitive
    CCCP: 0.3          # Extremely sensitive (high mitochondrial dependence)
    oligomycin: 0.3    # Extremely sensitive (ATP-starved neurons die quickly)
    etoposide: 0.8     # Somewhat sensitive (post-mitotic but DNA damage triggers apoptosis)
    MG132: 0.7         # Sensitive (neurons accumulate misfolded proteins)
    nocodazole: 2.0    # Resistant (need functional microtubules for axonal transport)
    paclitaxel: 2.5    # Resistant (stabilizing microtubules less toxic to post-mitotic cells)

  iPSC_Microglia:
    # iPSC-derived microglia - Brain immune cells, inflammatory response, ROS producers
    tBHQ: 1.2          # Resistant to oxidative stress (produce ROS as defense mechanism)
    H2O2: 1.5          # More resistant (high antioxidant capacity, ROS is their weapon)
    tunicamycin: 0.8   # Somewhat sensitive (high ER protein synthesis for cytokines)
    thapsigargin: 0.8  # Somewhat sensitive
    CCCP: 0.9          # Moderately sensitive (metabolically active but not neuron-level dependent)
    oligomycin: 0.9    # Moderately sensitive
    etoposide: 1.3     # Resistant (immune cells often resist DNA damage)
    MG132: 0.6         # Sensitive (high protein turnover, cytokine production)
    nocodazole: 1.1    # Slightly resistant (dividing but not fast)
    paclitaxel: 1.2    # Slightly resistant
